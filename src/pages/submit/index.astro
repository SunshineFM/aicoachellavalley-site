---
import BaseLayout from "../../layouts/BaseLayout.astro";
---

<BaseLayout title="Submit a Brief | AI Coachella Valley">
  <h1>Submit a Brief</h1>
  <p>A brief is a short, verifiable update about AI adoption, operations, or outcomes in the region.</p>

  <form id="submit-brief-form" class="submit-form" novalidate>
    <label class="honeypot" aria-hidden="true">
      Company
      <input type="text" name="company" autocomplete="off" tabindex="-1" />
    </label>

    <label>
      Title
      <input type="text" name="title" required minlength="10" maxlength="140" />
    </label>

    <label>
      Summary (1-3 sentences)
      <textarea name="summary" rows={4} required minlength="30" maxlength="600"></textarea>
    </label>

    <label>
      Source URL
      <input type="url" name="sourceUrl" required placeholder="https://example.com/source" />
    </label>

    <label>
      City (optional)
      <input type="text" name="city" />
    </label>

    <label>
      Sector (optional)
      <input type="text" name="sector" />
    </label>

    <label>
      Date (optional)
      <input type="date" name="date" />
    </label>

    <label>
      Submitter Name (optional)
      <input type="text" name="submitterName" autocomplete="name" />
    </label>

    <label>
      Submitter Email (optional)
      <input type="email" name="submitterEmail" autocomplete="email" />
    </label>

    <label>
      Notes (optional)
      <textarea name="notes" rows={4} maxlength="1200"></textarea>
    </label>

    <button type="submit" id="submit-btn">Submit Brief</button>
  </form>

  <p id="submit-status" class="note" role="status" aria-live="polite"></p>
  <p class="note">Where this goes: submissions are reviewed before publishing.</p>
</BaseLayout>

<script>
  const form = document.getElementById("submit-brief-form");
  const submitBtn = document.getElementById("submit-btn");
  const statusEl = document.getElementById("submit-status");

  form?.addEventListener("submit", async (event) => {
    event.preventDefault();
    if (!(form instanceof HTMLFormElement) || !(submitBtn instanceof HTMLButtonElement) || !statusEl) return;

    const fd = new FormData(form);
    const payload = {
      title: String(fd.get("title") || "").trim(),
      summary: String(fd.get("summary") || "").trim(),
      sourceUrl: String(fd.get("sourceUrl") || "").trim(),
      city: String(fd.get("city") || "").trim(),
      sector: String(fd.get("sector") || "").trim(),
      date: String(fd.get("date") || "").trim(),
      submitterName: String(fd.get("submitterName") || "").trim(),
      submitterEmail: String(fd.get("submitterEmail") || "").trim(),
      notes: String(fd.get("notes") || "").trim(),
      company: String(fd.get("company") || "").trim(),
    };

    submitBtn.disabled = true;
    statusEl.textContent = "Submitting...";

    try {
      const response = await fetch("/api/submit-brief.json", {
        method: "POST",
        headers: { "content-type": "application/json" },
        body: JSON.stringify(payload),
      });
      const data = await response.json();

      if (!response.ok) {
        statusEl.textContent = data.message || "Could not submit this brief.";
        return;
      }

      form.hidden = true;
      statusEl.textContent = "Thanks â€” queued for review.";
    } catch {
      statusEl.textContent = "Could not submit this brief right now.";
    } finally {
      submitBtn.disabled = false;
    }
  });
</script>

<style>
  .submit-form {
    margin-top: 1rem;
    display: grid;
    gap: 0.9rem;
    max-width: 44rem;
  }

  .submit-form label {
    display: grid;
    gap: 0.35rem;
    font-size: 0.95rem;
    color: #4b5360;
  }

  .honeypot {
    position: absolute;
    left: -9999px;
    width: 1px;
    height: 1px;
    overflow: hidden;
  }

  .submit-form input,
  .submit-form textarea {
    border: 1px solid #c8ced8;
    border-radius: 0.35rem;
    padding: 0.5rem 0.6rem;
    font: inherit;
    background: #fff;
  }

  .submit-form button {
    width: fit-content;
    border: 1px solid #184a9c;
    background: #184a9c;
    color: #fff;
    border-radius: 999px;
    padding: 0.4rem 0.95rem;
    font-weight: 600;
    cursor: pointer;
  }

  .note {
    margin-top: 1rem;
    border: 1px solid #d8dbe1;
    background: #fff;
    padding: 0.75rem 0.9rem;
  }
</style>
